<html>

<head>
    <link rel="stylesheet" href="/search/../styles/SearchStyle.css" type="text/css">
    <title>Search Results</title>
    
</head>
<header>
    <div class="navbar">
        <a href="/home/<%=userid%>" id="homelink">Home</a>
        <a href="#">Products</a>
        <a href="#">Shops</a>
        <a href="#">New Items</a>
        <div>
            <div class="profile-dropdown" style=" background-color:#ddd;">
                <a id="profile-link" href="/user/<%=userid%>" >Profile</a>
                <a href="#">Orders</a>
                <a href="#">Wishlist</a>
                <a href="/<%= userid%>/cart">Cart</a>
                <a href="/login">Logout</a>
            </div>
        </div>
    
        <h1 style="display: block; margin-left: auto; margin-right: auto;">Your Search Results</h1>
    </div>
</header>

<body>
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search...">
        <script>
            // Get the input field
            var input = document.getElementById("searchInput");
            // Execute a function when the user releases a key on the keyboard
            input.addEventListener("keyup", function (event) {
                // Number 13 is the "Enter" key on the keyboard
                if (event.keyCode === 13) {
                    // Cancel the default action, if needed
                    event.preventDefault();
                    // Trigger the button element with a click
                    var url = '/user/<%= userid %>/search?search=' + input.value;
                    window.location.href = url;
                    
                }
            });
        
        </script>
    </div>

    <section class="filter-options">
        <label for="price-filter">Filter by Price:</label>
        <select id="price-filter" onchange="filterByPrice()">
            <option value="all">All Prices</option>
            <option value="0-50">$0 - $50</option>
            <option value="50-100">$50 - $100</option>
            <option value="100-200">$100 - $200</option>
            <!-- Add more price ranges as needed -->
        </select>

        <label for="sort-by">Sort by:</label>
        <select id="sort-by" onchange="sortAndRender()">
            <option value="rating">Rating</option>
            <option value="price">Price</option>
        </select>
    </section>

    <div class="search-results" id="products-section">
        <!-- Product articles go here as in the previous examples -->

        <% if (products.length==0) {%>
            <h1 > No Product Found</h1>
            <% }%>
        <% for (var i = 0; i < products.length; i++) { %>
            <div class="card">
                <a href="/user/<%=userid  %>/product/<%= products[i].PRODUCT_ID %>"  >
                <img src="/../images/product/<%= products[i].PRODUCT_IMAGE %>" alt="Product Image" class="product-image">
                <% if (products[i].PRODUCT_NAME.length > 45) { %>
                    <h3 class="product-title"><%= products[i].PRODUCT_NAME.substring(0, 45) %>...</h3>
                <% } else { %>
                    <h3 class="product-title"><%= products[i].PRODUCT_NAME %></h3>
                    <% } %>
                    <% if (products[i].PRODUCT_DESCRIPTION.length > 50) { %>
                    <p class="product-description"><%= products[i].PRODUCT_DESCRIPTION.substring(0, 50) %>...
                    <b>  See More  </b></p>
                    <% } else { %>
                        <p class="product-description"><%= products[i].PRODUCT_DESCRIPTION %></p>
                    <% } %>

                <p class="product-price">$<%= products[i].PRODUCT_PRICE %></p>
                </a>
                <button onclick="addtocart('<%= products[i].PRODUCT_ID%>')" class="btn-primary">Add to Cart</button>
            </div>
        <% } %>

        <script>
            async function addtocart(id){
                var form = await document.createElement('form');
                form.method = 'post';
                form.action = '/user/<%= userid %>/addCart/'+id;
                document.body.appendChild(form);
                form.submit();

            }
        </script>


    </section>

    <script>
        // Assume you have an array of products

        var products = document.getElementById('products-section').innerHTML;   
        var filteredProducts = products;
        
        function sortAndRender() {
            const sortBy = document.getElementById('sort-by').value;

            if (sortBy === 'rating') {
                filteredProducts.sort((a, b) => b.PRODUCT_RATING - a.PRODUCT_RATING);
            } else if (sortBy === 'price') {
                filteredProducts.sort((a, b) => a.PRODUCT_PRICE - b.PRODUCT_PRICE);
            }

            renderProducts();
        }

        function search() {
            window.location.href = '/search?search=' + document.getElementById('searchInput').value;

        }

        function filterByPrice() {
            const priceFilter = document.getElementById('price-filter').value;
            if (priceFilter === 'all') {
                filteredProducts = products;
            } else {
                const [min, max] = priceFilter.split('-');
                filteredProducts = products.filter(product => product.PRODUCT_PRICE >= min && product.PRODUCT_PRICE <= max);
            }
        }



        // Initial rendering on page load
        renderProducts();
    </script>
</body>

</html>
